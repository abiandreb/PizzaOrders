<!-- Overlay -->
<div 
  [class]="'fixed inset-0 bg-black bg-opacity-50 z-40 transition-opacity duration-300 ' + (isVisible() ? 'opacity-100 visible' : 'opacity-0 invisible') "
  (click)="onCloseCart()">
</div>

<!-- Cart Panel -->
<div 
  [class]="'fixed top-0 right-0 h-full w-full max-w-md bg-white shadow-2xl z-50 transform transition-transform duration-300 ease-in-out ' + (isVisible() ? 'translate-x-0' : 'translate-x-full')">
  
  <div class="flex flex-col h-full">
    <!-- Header -->
    <div class="flex justify-between items-center p-5 border-b border-gray-200">
      <h2 class="text-2xl font-bold text-gray-800">Your Order</h2>
      <button (click)="onCloseCart()" class="text-gray-500 hover:text-gray-800">
        <i class="fas fa-times text-2xl"></i>
      </button>
    </div>

    <!-- Cart Items -->
    <div class="flex-grow overflow-y-auto p-5">
      @if (cart()?.items.length === 0) {
        <div class="flex flex-col items-center justify-center h-full text-center text-gray-500">
          <i class="fas fa-shopping-basket text-6xl mb-4"></i>
          <p class="text-lg">Your cart is empty.</p>
          <p>Add some delicious items to get started!</p>
        </div>
      } @else {
        <div class="space-y-4">
          @for (item of cart()?.items; track item.id) {
            <div class="flex items-center space-x-4 p-2 bg-gray-50 rounded-lg">
              <img [ngSrc]="item.product.imageUrl" [alt]="item.product.name" width="80" height="80" class="w-20 h-20 object-cover rounded-md">
              <div class="flex-grow">
                <h4 class="font-bold text-md">{{ item.product.name }}</h4>
                <p class="text-sm text-gray-600">${{ item.price.toFixed(2) }}</p>
              </div>
              <div class="flex items-center space-x-2">
                <button (click)="updateQuantity(item.id, item.quantity - 1)" class="w-6 h-6 rounded-full bg-gray-200 text-gray-700">-</button>
                <span>{{ item.quantity }}</span>
                <button (click)="updateQuantity(item.id, item.quantity + 1)" class="w-6 h-6 rounded-full bg-gray-200 text-gray-700">+</button>
              </div>
              <button (click)="removeItem(item.id)" class="text-red-500 hover:text-red-700">
                <i class="fas fa-trash"></i>
              </button>
            </div>
          }
        </div>
      }
    </div>

    <!-- Footer -->
    @if (cart() && cart()!.items.length > 0) {
      <div class="p-5 border-t border-gray-200 bg-gray-50">
        <div class="space-y-2 mb-4">
          <div class="flex justify-between text-lg">
            <span>Subtotal</span>
            <span>${{ cart()?.subtotal.toFixed(2) }}</span>
          </div>
          <div class="flex justify-between text-sm text-gray-600">
            <span>Tax (8%)</span>
            <span>${{ cart()?.tax.toFixed(2) }}</span>
          </div>
          <div class="flex justify-between text-xl font-bold">
            <span>Total</span>
            <span>${{ cart()?.total.toFixed(2) }}</span>
          </div>
        </div>
        <button (click)="openPaymentModal()" class="w-full bg-red-600 text-white font-bold py-3 rounded-lg text-lg hover:bg-red-700 transition-colors duration-300">
          Proceed to Payment
        </button>
      </div>
    }
  </div>
</div>

<app-payment-modal
  [isVisible]="isPaymentModalVisible()"
  [totalAmount]="cart()?.total ?? 0"
  (closeModal)="isPaymentModalVisible.set(false)"
  (paymentSuccess)="handlePaymentSuccess()">
</app-payment-modal>
